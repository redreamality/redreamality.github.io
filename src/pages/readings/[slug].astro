---
import { type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { getReadings, type Language } from '../../utils/i18n';

export async function getStaticPaths() {
  const readings = await getReadings('en');

  return readings.map((reading) => ({
    params: { slug: reading.slug },
    props: { reading, lang: 'en' as Language },
  }));
}

type Props = {
  reading: CollectionEntry<'readings-en'>;
  lang: Language;
};

const { reading, lang } = Astro.props;
const { Content } = await reading.render();

const basePath = lang === 'zh' ? '/cn' : '';
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<Layout
  title={`${reading.data.title} | My Readings`}
  description={reading.data.description}
  canonicalURL={canonicalURL}
  type="article"
  publishDate={reading.data.pubDate.toISOString()}
  tags={reading.data.tags || []}
>
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      <div class="mb-8">
        <a
          href={`${basePath}/readings`}
          class="inline-flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"
        >
          <span class="mr-2">â†</span>
          {lang === 'zh' ? 'è¿”å›é˜…è¯»æ”¶è—' : 'Back to My Readings'}
        </a>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
        <header class="mb-8">
          <h1 class="text-4xl font-bold mb-4 text-gray-900 dark:text-white">{reading.data.title}</h1>
          <p class="text-lg text-gray-600 dark:text-gray-300 mb-4">{reading.data.description}</p>

          <div class="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400">
            <div>
              <span class="mr-2">ğŸ“…</span>
              {reading.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </div>
            <div>
              <span class="mr-2">ğŸ”—</span>
              <a
                href={reading.data.url}
                target="_blank"
                rel="noopener noreferrer"
                class="hover:text-blue-600 dark:hover:text-blue-400"
              >
                {lang === 'zh' ? 'åŸæ–‡é“¾æ¥' : 'Source'}
              </a>
            </div>
            {reading.data.tags && reading.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2">
                <span class="mr-1">ğŸ·ï¸</span>
                {reading.data.tags.map((tag) => (
                  <span class="text-gray-600 dark:text-gray-300">#{tag}</span>
                ))}
              </div>
            )}
          </div>
        </header>

        <article class="prose prose-lg dark:prose-invert max-w-none">
          <Content />
        </article>
      </div>
    </div>
  </main>
</Layout>
