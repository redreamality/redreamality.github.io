<!--
  Anti-Adblock Component
  
  This component detects ad blockers and shows a message to users
  encouraging them to disable their ad blocker to support the site.
  
  Features:
  - Detects common ad blockers by checking if adsbygoogle.js is blocked
  - Shows a friendly message asking users to whitelist the site
  - Provides instructions for different ad blockers
  - Respects user privacy and doesn't track users
  - Configurable behavior and styling
-->

---
// Import configuration
import { getAntiAdblockConfig } from '../config/antiAdblockConfig';

const config = getAntiAdblockConfig();
---

<script is:inline define:vars={{ config }}>
  // Anti-adblock detection logic
  const checkAdBlock = () => {
    // Create a test ad element
    const testAd = document.createElement('div');
    testAd.innerHTML = '&nbsp;';
    testAd.className = 'adsbox';
    testAd.style.position = 'absolute';
    testAd.style.top = '-9999px';
    testAd.style.left = '-9999px';
    testAd.style.width = '1px';
    testAd.style.height = '1px';
    testAd.style.overflow = 'hidden';
    
    // Add the test element to the body
    document.body.appendChild(testAd);
    
    // Check if the element is blocked by ad blockers
    // Ad blockers typically hide or remove elements with ad-related class names
    const isBlocked = () => {
      return testAd.offsetHeight === 0 || 
             testAd.offsetWidth === 0 || 
             testAd.offsetLeft === -9999 ||
             testAd.clientHeight === 0 ||
             testAd.clientWidth === 0 ||
             window.getComputedStyle(testAd).display === 'none';
    };
    
    // Remove the test element
    document.body.removeChild(testAd);
    
    return isBlocked();
  };
  
  // Show the anti-adblock message if ad blocker is detected
  const showAntiAdblockMessage = () => {
    const antiAdblockElement = document.getElementById('anti-adblock-message');
    if (antiAdblockElement) {
      antiAdblockElement.style.display = 'block';
    }
  };
  
  // Initialize the anti-adblock detection
  const initAntiAdblock = () => {
    // Check if we should show the message only once per session
    if (config.showOncePerSession) {
      const sessionKey = 'antiAdblockShown';
      if (sessionStorage.getItem(sessionKey)) {
        return; // Already shown in this session
      }
    }
    
    // Wait a bit to allow ad blockers to process the page
    setTimeout(() => {
      if (checkAdBlock()) {
        showAntiAdblockMessage();
        if (config.showOncePerSession) {
          sessionStorage.setItem('antiAdblockShown', 'true');
        }
      }
    }, 1000);
  };
  
  // Run the detection when the page loads
  if (typeof window !== 'undefined') {
    initAntiAdblock();
  }
</script>

<style>
  #anti-adblock-message {
    display: none;
    position: fixed;
    bottom: 20px;
    right: 20px;
    max-width: 400px;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  #anti-adblock-message h3 {
    margin-top: 0;
    color: #333;
    font-size: 1.1rem;
  }
  
  #anti-adblock-message p {
    color: #666;
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 15px;
  }
  
  #anti-adblock-message .close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    color: #999;
    padding: 0;
    line-height: 1;
  }
  
  #anti-adblock-message .close-btn:hover {
    color: #666;
  }
  
  #anti-adblock-message .instructions {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
    font-size: 0.85rem;
  }
  
  #anti-adblock-message .instructions a {
    color: #0066cc;
    text-decoration: underline;
  }
  
  #anti-adblock-message .instructions a:hover {
    color: #004499;
  }
  
  @media (max-width: 768px) {
    #anti-adblock-message {
      bottom: 10px;
      right: 10px;
      left: 10px;
      max-width: none;
    }
  }
  
  .dark #anti-adblock-message {
    background-color: #2d3748;
    border-color: #4a5568;
    color: #e2e8f0;
  }
  
  .dark #anti-adblock-message h3 {
    color: #f7fafc;
  }
  
  .dark #anti-adblock-message p {
    color: #cbd5e0;
  }
  
  .dark #anti-adblock-message .close-btn {
    color: #a0aec0;
  }
  
  .dark #anti-adblock-message .close-btn:hover {
    color: #718096;
  }
  
  .dark #anti-adblock-message .instructions a {
    color: #63b3ed;
  }
  
  .dark #anti-adblock-message .instructions a:hover {
    color: #4299e1;
  }
</style>

<div id="anti-adblock-message">
  <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
  <h3>{config.message.title}</h3>
  <p>
    {config.message.content}
  </p>
  <div class="instructions">
    <p>
      {config.message.instructions}
      Here's how:
    </p>
    <ul style="padding-left: 20px; margin: 10px 0;">
      <li><strong>uBlock Origin:</strong> Click the uBlock icon ‚Üí Click the power button to disable for this site</li>
      <li><strong>AdBlock:</strong> Click the AdBlock icon ‚Üí "Don't run on this page"</li>
      <li><strong>AdGuard:</strong> Click the AdGuard icon ‚Üí "Pause on this website"</li>
    </ul>
    <p>Thank you for your support! üôè</p>
  </div>
</div>